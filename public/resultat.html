<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Résultat - FisherForce AI</title>
  <style>
    body { font-family: Arial; background: #f0fff9; padding: 20px; text-align: center; margin: 0; }
    .container { max-width: 400px; margin: auto; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,212,170,0.2); }
    label { display: block; margin: 15px 0 5px; text-align: left; font-weight: bold; }
    input, select { width: 100%; padding: 12px; border: 2px solid #00d4aa; border-radius: 10px; box-sizing: border-box; }
    button { width: 100%; padding: 15px; background: #00d4aa; color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 20px; }
    button:hover { background: #00a085; }
    #successBtn { background: #27ae60; }
    #failBtn { background: #e74c3c; }
    #successBtn:hover { background: #229954; }
    #failBtn:hover { background: #c0392b; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Enregistrer ta session</h1>
    <p id="spotInfo">Spot : <strong id="spotName">Spot inconnu</strong></p>

    <label>
      <input type="checkbox" id="success"> J'ai pris un poisson !
    </label>

    <div id="details" style="display:none;">
      <label>Espèce pêchée</label>
      <input type="text" id="species" placeholder="Ex: brochet, perche...">

      <label>Leurre utilisé</label>
      <input type="text" id="lure" placeholder="Ex: Jerkbait 11cm, Texas rig...">

      <label>Poids (kg)</label>
      <input type="number" id="weight" step="0.1" placeholder="Ex: 2.5">
    </div>

    <button id="successBtn" onclick="sendResult(true)">OUI ! Enregistrer</button>
    <button id="failBtn" onclick="sendResult(false)">NON, bredouille</button>
  </div>

  <script>
    // Récupère le spot depuis l'URL
    const urlParams = new URLSearchParams(window.location.search);
    const spot = urlParams.get('spot') || "Spot inconnu";
    document.getElementById('spotName').textContent = spot;

    // Affiche/masque les détails
    document.getElementById('success').addEventListener('change', function() {
      document.getElementById('details').style.display = this.checked ? 'block' : 'none';
    });

    function sendResult(success) {
      const species = document.getElementById('species').value.trim();
      const lure = document.getElementById('lure').value.trim();
      const weight = parseFloat(document.getElementById('weight').value) || 0;

      if (success && !species) {
        alert("Choisis une espèce !");
        return;
      }

      // Envoie à la page principale
      window.opener.postMessage({
        type: 'ADD_XP',
        success: success,
        speciesName: success ? species : null,
        spotName: spot,
        lure: lure,
        weight: weight
      }, '*');

      const msg = success ? `Prise de ${species} enregistrée ! (${weight}kg)` : "Session bredouille enregistrée.";
      alert(msg);
      window.close();
    }
  </script>
</body>
</html>
