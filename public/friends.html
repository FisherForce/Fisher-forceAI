<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Amis FisherForce</title>
  <style>
    body { font-family: Arial; background: #f0fff9; padding: 20px; text-align: center; margin: 0; }
    .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,212,170,0.2); max-width: 500px; margin: 20px auto; }
    input { width: 80%; padding: 12px; border-radius: 12px; border: 2px solid #00d4aa; font-size: 16px; margin: 10px; }
    button { background: #00d4aa; color: white; padding: 12px 20px; border: none; border-radius: 12px; cursor: pointer; margin: 10px; font-weight: bold; }
    button:hover { background: #00a085; }
    .friend { background: #e6fffa; padding: 15px; border-radius: 15px; margin: 10px; text-align: left; display: flex; justify-content: space-between; align-items: center; }
    .pending { background: #fff3cd; }
    .status { color: #00d4aa; font-weight: bold; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Amis FisherForce</h1>
    <p class="status">Connecté en tant que <span id="userName">Thao</span></p>

    <input type="text" id="searchFriend" placeholder="Rechercher un pseudo...">
    <button onclick="searchFriend()">Rechercher</button>
    <div id="searchResults"></div>

    <h2>Mes amis</h2>
    <div id="friendsList">Aucun ami pour l’instant</div>

    <h2>Demandes en attente</h2>
    <div id="pendingRequests">Aucune demande</div>
  </div>

  <script>
    // === DONNÉES SIMULÉES LOCALES (pas de Firebase) ===
    const currentUser = { name: localStorage.getItem('fisherUserName') || 'Thao' };
    document.getElementById('userName').textContent = currentUser.name;

    // Base de données locale simulée
    const fakeUsers = [
      { name: "LoulouPeche", xp: 285, level: "Maître du brochet" },
      { name: "BrochetKiller", xp: 220, level: "Traqueur" },
      { name: "PercheMaster", xp: 190, level: "Traqueur" },
      { name: "Carpiste72", xp: 165, level: "Débutant" },
      { name: "TruiteNinja", xp: 140, level: "Débutant" }
    ];

    // Sauvegarde locale
    const friends = JSON.parse(localStorage.getItem('fisherFriends') || '[]');
    const pending = JSON.parse(localStorage.getItem('fisherPending') || '[]');

    // === RECHERCHE ===
    function searchFriend() {
      const query = document.getElementById('searchFriend').value.trim().toLowerCase();
      const results = document.getElementById('searchResults');
      results.innerHTML = '';

      if (!query) return;

      const matches = fakeUsers.filter(u => u.name.toLowerCase().includes(query) && !friends.includes(u.name) && !pending.includes(u.name));
      
      if (matches.length === 0) {
        results.innerHTML = '<p style="color:#e74c3c;">Aucun pêcheur trouvé</p>';
        return;
      }

      matches.forEach(user => {
        results.innerHTML += `
          <div class="friend">
            <div>
              <strong>${user.name}</strong> — ${user.xp} XP (${user.level})
            </div>
            <button onclick="sendRequest('${user.name}')">Ajouter</button>
          </div>`;
      });
    }

    // === ENVOYER DEMANDE ===
    function sendRequest(name) {
      pending.push(name);
      localStorage.setItem('fisherPending', JSON.stringify(pending));
      alert(`Demande envoyée à ${name} !`);
      updateLists();
    }

    // === ACCEPTER DEMANDE (simulation) ===
    function acceptRequest(name) {
      const idx = pending.indexOf(name);
      if (idx > -1) {
        pending.splice(idx, 1);
        friends.push(name);
        localStorage.setItem('fisherPending', JSON.stringify(pending));
        localStorage.setItem('fisherFriends', JSON.stringify(friends));
        alert(`${name} est maintenant ton ami !`);
        updateLists();
      }
    }

    // === MISE À JOUR DES LISTES ===
    function updateLists() {
      // Amis
      const friendsList = document.getElementById('friendsList');
      if (friends.length === 0) {
        friendsList.innerHTML = 'Aucun ami pour l’instant';
      } else {
        friendsList.innerHTML = friends.map(name => {
          const user = fakeUsers.find(u => u.name === name);
          return `<div class="friend"><strong>${name}</strong> — ${user.xp} XP</div>`;
        }).join('');
      }

      // Demandes
      const pendingList = document.getElementById('pendingRequests');
      if (pending.length === 0) {
        pendingList.innerHTML = 'Aucune demande';
      } else {
        pendingList.innerHTML = pending.map(name => `
          <div class="pending">
            <strong>${name}</strong> veut être ton ami
            <button onclick="acceptRequest('${name}')">Accepter</button>
          </div>
        `).join('');
      }
    }

    // Init
    updateLists();
  </script>
</body>
</html>
